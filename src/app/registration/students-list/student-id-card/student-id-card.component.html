<!-- Dialog Container -->
<div class="dialog-container">
  <!-- Header -->
  <mat-toolbar class="dialog-toolbar">
    <div class="toolbar-content">
      <div class="title-section">
        <mat-icon class="title-icon">badge</mat-icon>
        <h2 class="dialog-title">Student ID Card Preview</h2>
      </div>
      <div class="toolbar-actions">
        <button mat-icon-button (click)="closeDialog()" matTooltip="Close" aria-label="Close dialog">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </mat-toolbar>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="loading-text">Generating ID Card...</p>
  </div>

  <!-- ID Card Content -->
  <div class="id-card-wrapper" *ngIf="!isLoading">
    <!-- Preview ID Card -->
    <div class="id-card-container" id="id-card-content">
      <div class="id-card-content">
        <!-- Top Banner -->
        <div class="card-header">
          <div class="school-brand">
            <div class="school-logo">
              <ng-container *ngIf="systemSettings?.schoolLogo; else initialsLogo">
                <img
                  [src]="systemSettings!.schoolLogo"
                  alt="School Logo"
                  class="school-logo-img"
                />
              </ng-container>
              <ng-template #initialsLogo>
                <span class="logo-circle">
                  {{ (systemSettings?.schoolName || 'Anarphy High School') | slice:0:1 }}
                </span>
              </ng-template>
            </div>
            <div class="school-text">
              <h2 class="school-name">
                {{ systemSettings?.schoolName || 'Anarphy High School' }}
              </h2>
              <p class="school-address">
                {{ systemSettings?.schoolAddress || '123 School Street, Education City' }}
              </p>
            </div>
          </div>
        </div>

        <!-- Name strip -->
        <div class="name-strip">
          <span class="name-text">{{ student.name }} {{ student.surname }}</span>
        </div>

        <!-- Main content -->
        <div class="card-body">
          <!-- Left details -->
          <div class="details-column">
            <div class="detail-row">
              <span class="detail-label">Student ID</span>
              <span class="detail-value">{{ student.studentNumber }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">ID Number</span>
              <span class="detail-value">{{ student.idnumber || 'Not provided' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">D.O.B</span>
              <span class="detail-value">
                {{ student.dob ? (student.dob | date:'MMM d, y') : 'Not provided' }}
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Gender</span>
              <span class="detail-value">{{ student.gender }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Address</span>
              <span class="detail-value">{{ student.address || 'Not provided' }}</span>
            </div>
          </div>

          <!-- Right photo / QR column -->
          <div class="photo-column">
            <div class="photo-circle">
              <!-- If you later add real photos, bind <img> here -->
              <div class="photo-placeholder">
                <span class="initials">
                  {{ (student.name | slice:0:1) }}{{ (student.surname | slice:0:1) }}
                </span>
              </div>
            </div>
            <div class="qr-under-photo" *ngIf="qrCodeDataUrl">
              <img [src]="qrCodeDataUrl" alt="QR Code">
              <div class="qr-caption">Scan for details</div>
            </div>
          </div>
        </div>

        <!-- Bottom bar -->
        <div class="card-footer">
          <span class="valid-label">
            Valid until:
            {{ (currentDate.getFullYear() + 1) }}/{{ (currentDate.getMonth() + 1).toString().padStart(2, '0') }}/{{ currentDate.getDate().toString().padStart(2, '0') }}
          </span>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button 
        mat-raised-button 
        color="primary" 
        (click)="printIDCard()"
        class="action-button print-button">
        <mat-icon>print</mat-icon>
        Print ID Card
      </button>
      <button 
        mat-raised-button 
        color="accent" 
        (click)="downloadIDCard()"
        class="action-button download-button">
        <mat-icon>download</mat-icon>
        Download
      </button>
    </div>

    <!-- Instructions -->
    <div class="instructions">
      <mat-card class="instructions-card">
        <mat-card-header>
          <mat-icon class="instructions-icon">info</mat-icon>
          <mat-card-title>Instructions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <ul class="instructions-list">
            <li>Click "Print ID Card" to print the card in standard ID card size (3.375" x 2.125")</li>
            <li>Click "Download" to save the ID card as an image file</li>
            <li>The QR code can be scanned to view student details online</li>
            <li>For best print quality, use high-resolution printing settings</li>
          </ul>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>