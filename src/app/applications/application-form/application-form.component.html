<div class="application-form-container" [class.dark-theme]="currentTheme === 'dark'">
  <mat-card class="application-card">
    <mat-card-header>
      <mat-card-title>Student Application Form</mat-card-title>
      <mat-card-subtitle>Please fill in all required fields to submit your application</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content *ngIf="!applicationId">
      <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()">
        <!-- Personal Information Section -->
        <h3>Personal Information</h3>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>First Name *</mat-label>
            <input matInput formControlName="name" required>
            <mat-error *ngIf="applicationForm.get('name')?.hasError('required')">
              First name is required
            </mat-error>
            <mat-error *ngIf="applicationForm.get('name')?.hasError('minlength')">
              First name must be at least 2 characters
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Surname *</mat-label>
            <input matInput formControlName="surname" required>
            <mat-error *ngIf="applicationForm.get('surname')?.hasError('required')">
              Surname is required
            </mat-error>
            <mat-error *ngIf="applicationForm.get('surname')?.hasError('minlength')">
              Surname must be at least 2 characters
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Gender *</mat-label>
            <mat-select formControlName="gender" required>
              <mat-option *ngFor="let gender of genders" [value]="gender">
                {{ gender }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="applicationForm.get('gender')?.hasError('required')">
              Gender is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Date of Birth</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="dob">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>ID Number</mat-label>
            <input matInput formControlName="idnumber">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email">
            <mat-error *ngIf="applicationForm.get('email')?.hasError('email')">
              Please enter a valid email address
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Cell Phone</mat-label>
            <input matInput formControlName="cell">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Address</mat-label>
            <input matInput formControlName="address">
          </mat-form-field>
        </div>

        <!-- Academic Information Section -->
        <h3>Academic Information</h3>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Desired Class/Level *</mat-label>
            <input matInput formControlName="desiredClass" required>
            <mat-hint>e.g., Form 1, Form 2, Lower 6, etc.</mat-hint>
            <mat-error *ngIf="applicationForm.get('desiredClass')?.hasError('required')">
              Desired class is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Previous School</mat-label>
            <input matInput formControlName="prevSchool">
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Previous School Records/Results</mat-label>
          <textarea matInput formControlName="prevSchoolRecords" rows="4" placeholder="Please provide any relevant academic records or results"></textarea>
        </mat-form-field>

        <!-- Parent/Guardian Information Section -->
        <h3>Parent/Guardian Information</h3>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Parent/Guardian First Name *</mat-label>
            <input matInput formControlName="parentName" required>
            <mat-error *ngIf="applicationForm.get('parentName')?.hasError('required')">
              Parent/Guardian first name is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Parent/Guardian Surname *</mat-label>
            <input matInput formControlName="parentSurname" required>
            <mat-error *ngIf="applicationForm.get('parentSurname')?.hasError('required')">
              Parent/Guardian surname is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Relationship</mat-label>
            <mat-select formControlName="parentRelationship">
              <mat-option *ngFor="let rel of relationships" [value]="rel">
                {{ rel }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Parent/Guardian Email</mat-label>
            <input matInput type="email" formControlName="parentEmail">
            <mat-error *ngIf="applicationForm.get('parentEmail')?.hasError('email')">
              Please enter a valid email address
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Parent/Guardian Cell Phone</mat-label>
          <input matInput formControlName="parentCell">
        </mat-form-field>

        <div class="form-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="applicationForm.invalid || isLoading"
          >
            <mat-spinner *ngIf="isLoading" diameter="20" class="inline-spinner"></mat-spinner>
            <span *ngIf="!isLoading">Submit Application</span>
            <span *ngIf="isLoading">Submitting...</span>
          </button>
        </div>
      </form>
    </mat-card-content>

    <!-- Success Message -->
    <mat-card-content *ngIf="applicationId" class="success-message">
      <div class="success-content">
        <mat-icon class="success-icon">check_circle</mat-icon>
        <h2>Application Submitted Successfully!</h2>
        <p>Your application reference number is:</p>
        <p class="application-id">{{ applicationId }}</p>
        <p>Please save this reference number. You will receive a confirmation email and SMS shortly.</p>
        <div class="action-buttons">
          <button mat-raised-button color="primary" (click)="trackApplication()">
            Track Application Status
          </button>
          <button mat-button (click)="applicationId = null; applicationForm.reset()">
            Submit Another Application
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>



